<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Genzade  - postgres cheatsheet + notes </title>
    <link rel="stylesheet" href="https://genzade.github.io/assets/css/main.css">
    <link rel="icon" type="image/x-icon" href="/assets/images/favicon.svg" />
    <script type="module" src="https://unpkg.com/@hotwired/turbo@7.1.0/dist/turbo.es2017-umd.js"></script>
    
    <script src="https://genzade.github.io/assets/js/article/toc-marker.js" defer></script>
    
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>postgres cheatsheet + notes | Genzade</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="postgres cheatsheet + notes" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="My notes from freecodecamp.org’s sql course as well as my own pg cheetsheat. The accompanying code for these notes can be found in my github repo" />
<meta property="og:description" content="My notes from freecodecamp.org’s sql course as well as my own pg cheetsheat. The accompanying code for these notes can be found in my github repo" />
<link rel="canonical" href="https://genzade.github.io/articles/2023/12/09/postgres-cheatsheet.html" />
<meta property="og:url" content="https://genzade.github.io/articles/2023/12/09/postgres-cheatsheet.html" />
<meta property="og:site_name" content="Genzade" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-12-09T22:10:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="postgres cheatsheet + notes" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-12-09T22:10:00+00:00","datePublished":"2023-12-09T22:10:00+00:00","description":"My notes from freecodecamp.org’s sql course as well as my own pg cheetsheat. The accompanying code for these notes can be found in my github repo","headline":"postgres cheatsheet + notes","mainEntityOfPage":{"@type":"WebPage","@id":"https://genzade.github.io/articles/2023/12/09/postgres-cheatsheet.html"},"url":"https://genzade.github.io/articles/2023/12/09/postgres-cheatsheet.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body class="antialiased bg-slate-700 min-h-screen">
    <header
  class="before:bg-[rgba(0, 0, 0, 0.1)] fixed left-0 top-0 z-[100] flex h-24 w-full items-center p-5 text-white before:absolute before:left-0 before:top-0 before:z-[-1] before:h-full before:w-full before:backdrop-blur-[50px] sm:justify-evenly lg:p-6"
>
  <div class="container mx-auto flex max-w-5xl items-center justify-between px-0">
    <div class="flex">
      <a href="/">
        <div class="m-0 h-24 w-24"><?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1200 1200" x="0px" y="0px">
  <circle cx="50%" cy="50%" r="520" stroke="black" stroke-width="60" fill="#00F603" />
  <g transform="translate(0.000000,1200.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none">
    <path d="M5878 8797 c-313 -161 -773 -555 -998 -855 -97 -129 -149 -226 -185 -347 -15 -49 -61 -182 -102 -295 -41 -113 -90 -257 -108 -320 -35 -122 -63 -266 -53 -275 3 -4 37 16 74 43 405 294 1131 573 1489 573 352 0 1044 -262 1473 -558 52 -35 96 -62 100 -59 18 19 -63 315 -158 576 -37 102 -83 235 -103 297 -61 190 -133 308 -303 503 -237 272 -635 595 -892 724 -96 48 -129 47 -234 -7z" />
    <path d="M5845 7144 c-184 -33 -410 -104 -641 -201 l-132 -55 15 -66 c35 -154 112 -319 204 -438 116 -151 346 -329 593 -459 l108 -58 71 34 c111 53 289 162 390 237 106 80 235 211 294 297 85 126 163 319 166 412 l2 47 -121 52 c-291 125 -627 215 -799 213 -38 0 -106 -7 -150 -15z" />
    <path d="M4841 6769 c-129 -70 -342 -217 -379 -261 -10 -13 27 -85 224 -428 129 -227 238 -419 241 -427 4 -11 -11 -13 -87 -11 l-93 3 -134 235 c-74 129 -138 239 -143 244 -12 12 -155 -49 -283 -121 -109 -61 -124 -78 -233 -257 l-61 -101 -1067 -5 -1067 -5 216 -312 c118 -172 215 -317 215 -323 0 -5 -94 -147 -210 -315 -116 -167 -210 -309 -210 -315 0 -7 253 -10 781 -10 740 0 781 -1 773 -17 -4 -10 -9 -68 -12 -129 -5 -126 16 -230 67 -339 81 -173 253 -335 432 -405 l46 -18 26 29 c24 28 29 29 106 29 l81 0 0 425 0 425 85 0 85 0 0 -425 0 -425 596 0 596 0 -53 48 c-62 56 -121 143 -150 224 -12 32 -24 58 -27 58 -2 0 -24 -18 -48 -40 -43 -40 -44 -40 -123 -40 -68 0 -82 -3 -90 -19 -17 -30 -78 -54 -127 -48 -122 13 -174 149 -93 242 56 64 140 70 203 15 26 -23 43 -30 76 -30 38 0 49 6 107 60 35 33 68 60 73 60 6 0 10 27 10 60 l0 60 -149 0 c-129 0 -152 -2 -167 -17 -35 -37 -70 -53 -112 -53 -86 0 -152 60 -152 138 0 45 27 107 54 124 6 4 50 8 97 8 73 0 89 -3 104 -20 17 -18 31 -20 172 -20 146 0 153 1 153 20 0 18 7 20 79 20 l79 0 4 -227 c4 -199 7 -235 25 -285 27 -72 46 -102 102 -161 58 -61 127 -103 290 -176 71 -32 152 -72 180 -90 l51 -31 57 37 c32 20 98 54 148 76 237 102 341 179 394 291 41 84 51 160 51 379 l0 187 80 0 c73 0 80 -2 80 -20 0 -19 7 -20 153 -20 141 0 155 2 172 20 15 17 31 20 105 20 82 0 88 -1 114 -29 20 -21 30 -43 33 -75 7 -57 -9 -97 -54 -136 -46 -41 -120 -42 -176 -5 -20 14 -37 30 -37 36 0 6 -57 8 -152 7 l-153 -3 -2 -55 -3 -55 71 -62 c67 -59 75 -63 121 -63 33 0 50 5 54 15 3 8 26 24 50 35 74 36 160 6 199 -71 45 -87 -33 -209 -133 -209 -36 0 -100 29 -121 54 -10 12 -32 16 -88 16 l-74 0 -48 45 -49 46 -12 -38 c-26 -79 -86 -179 -146 -240 l-62 -63 599 0 599 0 0 425 0 425 80 0 80 0 0 -424 0 -424 84 -3 c72 -3 88 -7 110 -28 l25 -24 57 23 c31 13 89 44 128 70 186 123 307 300 347 508 12 62 8 233 -6 279 l-7 23 785 2 786 3 -214 312 c-118 171 -215 316 -215 321 0 5 97 150 216 323 l215 314 -1068 3 -1068 2 -39 68 c-69 119 -148 232 -175 251 -44 31 -192 108 -278 145 l-82 35 -143 -250 -142 -249 -88 0 c-48 0 -88 2 -88 5 0 3 108 195 241 427 l240 423 -40 36 c-66 59 -213 160 -323 222 -56 31 -106 57 -110 57 -5 0 -8 -6 -8 -14 0 -32 -54 -197 -91 -275 -59 -127 -141 -242 -251 -354 l-99 -102 1 -212 1 -213 -80 0 -81 0 0 150 c0 83 -3 150 -6 150 -3 0 -50 -26 -103 -59 -154 -93 -325 -181 -354 -181 -32 0 -211 88 -350 172 -54 32 -105 62 -113 65 -12 4 -14 -18 -14 -146 l0 -151 -80 0 -80 0 0 212 0 211 -98 101 c-162 167 -254 318 -313 511 -17 55 -34 108 -37 117 -6 16 -15 13 -81 -23z m-1883 -1303 c103 -16 175 -46 240 -102 l43 -36 -3 -97 -3 -96 -105 0 -105 0 -3 43 c-4 56 -31 74 -125 80 -99 6 -149 -10 -208 -65 -55 -51 -79 -111 -79 -195 0 -163 83 -247 251 -256 105 -5 173 18 181 62 10 52 -8 60 -120 52 -71 -5 -102 -3 -107 5 -14 21 -18 135 -6 157 11 22 16 22 226 22 158 0 216 -3 221 -12 5 -7 7 -86 5 -177 -2 -147 -5 -167 -23 -192 -34 -46 -99 -85 -188 -114 -73 -24 -102 -28 -200 -28 -224 0 -362 74 -452 240 -58 106 -61 347 -6 463 32 67 124 152 211 195 64 31 147 52 252 64 6 0 52 -5 103 -13z m1236 -31 c10 -36 6 -256 -4 -276 -12 -21 -66 -25 -145 -11 -39 7 -40 9 -45 52 l-5 45 -120 -4 c-74 -2 -123 -8 -128 -15 -12 -17 0 -118 15 -127 7 -5 57 -9 111 -9 l98 0 -3 -97 -3 -98 -99 -2 c-123 -3 -131 -8 -121 -87 l7 -56 134 0 134 0 0 44 0 43 87 6 c51 4 92 2 97 -3 12 -12 16 -299 4 -306 -12 -7 -794 -5 -813 2 -18 7 -21 136 -5 179 9 23 13 25 46 19 26 -5 39 -3 45 7 14 22 11 493 -3 507 -7 7 -29 12 -49 12 -37 0 -37 0 -44 50 -4 28 -4 71 0 98 l6 47 399 0 c393 1 399 0 404 -20z m493 -7 c16 -18 45 -55 63 -83 18 -27 57 -77 86 -111 29 -33 70 -87 92 -120 53 -79 111 -140 121 -128 5 5 6 67 4 137 l-6 128 -41 -3 -41 -3 -3 94 c-2 60 1 98 9 107 9 11 50 14 199 14 103 0 202 -3 219 -6 l31 -6 0 -89 c0 -99 -7 -109 -74 -109 l-36 0 2 -351 c1 -293 -1 -352 -13 -360 -8 -5 -59 -9 -114 -9 l-100 0 -135 181 c-74 99 -154 204 -177 232 -24 28 -43 54 -43 59 0 4 -7 8 -15 8 -13 0 -15 -22 -15 -135 l0 -135 38 0 c60 0 63 -6 60 -111 l-3 -94 -230 0 -230 0 -3 88 c-3 104 3 117 56 110 25 -3 41 0 48 8 7 9 9 97 6 262 l-4 247 -44 0 c-33 0 -46 5 -54 19 -15 29 -13 178 3 184 6 3 80 6 163 6 l150 1 31 -32z m1621 17 c14 -14 2 -67 -25 -106 -16 -24 -46 -74 -66 -111 -20 -36 -96 -154 -167 -262 -72 -108 -128 -201 -125 -206 3 -6 46 -10 96 -10 l89 0 0 64 0 63 103 6 c56 3 105 2 110 -2 4 -4 6 -84 5 -177 l-3 -169 -400 0 -400 0 -3 35 c-3 32 20 71 198 344 127 193 199 313 196 323 -5 12 -18 14 -79 8 -39 -4 -73 -9 -75 -10 -2 -2 -6 -28 -9 -58 l-6 -55 -94 -7 c-52 -4 -98 -4 -103 1 -12 12 -13 38 -12 196 l2 137 103 4 c135 5 659 -2 665 -8z m833 8 c9 -2 23 -18 30 -36 7 -18 42 -93 79 -167 37 -74 95 -203 128 -287 84 -207 94 -223 142 -223 54 0 61 -14 58 -117 l-3 -88 -217 0 c-131 0 -221 4 -227 10 -6 6 -8 41 -4 87 5 67 8 77 26 80 30 4 43 32 31 65 l-9 28 -162 3 c-155 2 -163 2 -173 -18 -19 -36 -9 -64 25 -70 l30 -5 0 -90 0 -90 -225 0 -225 0 -5 89 c-6 104 1 116 60 116 l39 0 42 88 c123 260 170 365 175 392 6 28 5 30 -24 30 -60 0 -62 4 -62 104 0 51 3 95 6 99 7 7 439 7 465 0z m1229 -27 c118 -45 159 -76 229 -177 45 -65 61 -126 61 -240 0 -77 -5 -115 -24 -173 -35 -105 -49 -128 -109 -180 -123 -105 -219 -126 -577 -126 -142 0 -261 4 -264 8 -8 13 -10 181 -2 189 4 4 28 6 54 5 l47 -2 0 263 0 262 -40 1 c-22 0 -46 2 -52 2 -14 2 -19 183 -6 196 4 4 143 6 308 4 l300 -4 75 -28z m1174 9 c10 -36 6 -256 -4 -276 -12 -21 -66 -25 -145 -11 -39 7 -40 9 -45 52 l-5 45 -120 -4 c-74 -2 -123 -8 -128 -15 -12 -17 0 -118 15 -127 7 -5 57 -9 111 -9 l98 0 -3 -97 -3 -98 -99 -2 c-123 -3 -131 -8 -121 -87 l7 -56 134 0 134 0 0 44 0 43 87 6 c51 4 92 2 97 -3 12 -12 16 -299 4 -306 -12 -7 -794 -5 -813 2 -18 7 -21 136 -5 179 9 23 13 25 46 19 26 -5 39 -3 45 7 14 22 11 493 -3 507 -7 7 -29 12 -49 12 -37 0 -37 0 -44 50 -4 28 -4 71 0 98 l6 47 399 0 c393 1 399 0 404 -20z m-3154 -1311 c0 -221 -1 -239 -21 -274 -42 -74 -48 -75 -369 -75 -407 0 -390 -15 -390 344 l0 241 390 0 390 0 0 -236z" />
    <path d="M6983 5173 c-3 -10 -17 -42 -30 -72 -34 -78 -27 -91 53 -91 48 0 66 4 70 15 4 8 -6 49 -21 90 -21 57 -32 75 -47 75 -10 0 -21 -8 -25 -17z" />
    <path d="M8073 5242 l-32 -3 -3 -102 c-2 -56 -2 -166 0 -244 l3 -143 100 0 c117 0 150 11 201 68 36 40 51 76 64 159 10 67 -26 172 -76 217 -22 19 -50 38 -62 40 -31 7 -156 12 -195 8z" />
    <path d="M5770 4120 l0 -180 230 0 230 0 0 180 0 180 -230 0 -230 0 0 -180z m304 116 c40 -37 47 -80 21 -126 -8 -14 -14 -39 -15 -57 0 -19 -10 -43 -23 -59 -47 -55 -137 -19 -137 55 0 20 -7 45 -15 55 -8 11 -15 37 -15 59 0 31 7 46 34 73 48 48 100 48 150 0z" />
    <path d="M4022 3258 l3 -93 1969 -3 c1479 -1 1972 1 1983 10 10 8 13 32 11 92 l-3 81 -863 3 -864 2 -61 -29 c-34 -17 -86 -50 -115 -75 -70 -60 -94 -60 -164 -1 -29 25 -79 59 -112 75 l-59 30 -864 0 -864 0 3 -92z" />
  </g>
</svg>
</div>
      </a>
    </div>

    <div class="flex items-center">
      <input type="checkbox" id="check" />

      <label for="check" class="icons absolute right-0 block cursor-pointer pr-4">
        <i id="menu-icon" class="visible md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" width="60" height="60" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5"/>
</svg>
 </i>
        <i id="close-icon" class="md:hidden"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" width="60" height="60" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
</svg>
 </i>
      </label>

      <nav
  class="navbar bg-[rgba(0, 0, 0, 0.1)] absolute left-0 top-full z-[100] h-0 w-screen overflow-hidden backdrop-blur-[50px] md:relative md:top-0 md:h-auto md:w-max md:backdrop-blur-[0px]"
>
  
   <!-- TODO: flesh out and bring back 'about' page -->
  <a
    href="/"
    class="text-sm my-4 block px-20 md:m-2 md:inline-flex md:px-0 md:pl-1"
    style="--i:0"
    
  >
    <div class="flex items-center justify-center">
      <div class="inline-flex">
        <div class="h-8 w-8 self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
</svg>
</div>
        <span class="items-center py-5 pl-2 text-center text-lg font-extrabold"> Home </span>
      </div>
    </div>
  </a>
  
  
  
  
   <!-- TODO: flesh out and bring back 'about' page -->
  <a
    href="/articles"
    class="text-sm my-4 block px-20 md:m-2 md:inline-flex md:px-0 md:pl-1"
    style="--i:2"
    
  >
    <div class="flex items-center justify-center">
      <div class="inline-flex">
        <div class="h-8 w-8 self-center"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 002.25 2.25h13.5M6 7.5h3v3H6v-3z" />
</svg>
</div>
        <span class="items-center py-5 pl-2 text-center text-lg font-extrabold"> Articles </span>
      </div>
    </div>
  </a>
  
  
   <!-- TODO: flesh out and bring back 'about' page -->
  <a
    href="https://github.com/genzade/genzade.github.io"
    class="text-sm my-4 block px-20 md:m-2 md:inline-flex md:px-0 md:pl-1"
    style="--i:3"
    
      target="_blank"
    
  >
    <div class="flex items-center justify-center">
      <div class="inline-flex">
        <div class="h-8 w-8 self-center"><svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px]" viewBox="0 0 98 96">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-3.015.324-3.015 4.934.326 7.523 5.052 7.523 5.052 4.367 7.496 11.404 5.378 14.235 4.074.404-3.178 1.699-5.378 3.074-6.6-10.839-1.141-22.243-5.378-22.243-24.283 0-5.378 1.94-9.778 5.014-13.2-.485-1.222-2.184-6.275.486-13.038 0 0 4.125-1.304 13.426 5.052a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.356 13.427-5.052 13.427-5.052 2.67 6.763.97 11.816.485 13.038 3.155 3.422 5.015 7.822 5.015 13.2 0 18.905-11.404 23.06-22.324 24.283 1.78 1.548 3.316 4.481 3.316 9.126 0 6.6-.08 11.897-.08 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#fff"/>
</svg>
</div>
        <span class="items-center py-5 pl-2 text-center text-lg font-extrabold"> Github </span>
      </div>
    </div>
  </a>
  
  
</nav>

    </div>
  </div>
</header>


    <div class="px-4 my-28">
      <div class="max-w-5xl bg-slate-900 rounded-lg mx-auto my-16 p-6">
        
        <h1 class="text-5xl font-extrabold text-center pt-10 uppercase">postgres cheatsheet + notes</h1>
        

        <div class="mt-6">
          <article class="prose my-6 max-w-none break-words px-2 md:prose-lg lg:prose-xl md:pt-24">
  <div class="mx-auto mt-16">
    <div class="flex justify-between">
      <p class="text-sm">

67 minutes to read

</p>
      <p class="text-sm">09 Dec 2023</p>
    </div>

    <div class="md:grid md:grid-cols-9 md:gap-2">
      <section class="sm:col-span-7"><p>My notes from <a href="https://www.freecodecamp.org/" target="\_blank">freecodecamp.org</a>’s
sql course as well as my own pg cheetsheat. The accompanying code for these notes
can be found in my <a href="https://github.com/genzade/postGRES" target="\_blank">github repo</a></p>

<h2 id="prerequisites">
<a class="anchor" href="#prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites</h2>

<ul>
  <li><a href="https://www.docker.com/" target="\_blank"><code class="language-plaintext highlighter-rouge">docker</code></a></li>
  <li><a href="https://docs.docker.com/engine/reference/commandline/compose/" target="\_blank"><code class="language-plaintext highlighter-rouge">docker-compose</code></a></li>
  <li>
<a href="https://www.pgcli.com/" target="\_blank"><code class="language-plaintext highlighter-rouge">pgcli</code></a> (optional, use <code class="language-plaintext highlighter-rouge">psql</code> or a GUI app of your choice)</li>
</ul>

<h2 id="setup">
<a class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker-compose up <span class="nt">-d</span> db
<span class="o">[</span>+] Running 2/2
 ✔ Network postgres_default  Created                     0.0s
 ✔ Container postgres-db-1   Started                     0.2s
</code></pre></div></div>

<h2 id="run">
<a class="anchor" href="#run" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pgcli postgresql://postgres:1234@localhost:5432/postgres
Server: PostgreSQL 15.2 <span class="o">(</span>Debian 15.2-1.pgdg110+1<span class="o">)</span>
Version: 4.0.1
Home: http://pgcli.com
postgres@localhost:postgres&gt;
</code></pre></div></div>

<h3 id="note-regarding-pgcli-command">
<a class="anchor" href="#note-regarding-pgcli-command" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note regarding PGCLI command</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pgcli postgresql://postgres:PASSWORD@localhost:PORT/POSTGRES_USER
<span class="c"># or you can use</span>
<span class="nv">$ </span>pgcli <span class="nt">-h</span> localhost <span class="nt">-p</span> PORT <span class="nt">-U</span> POSTGRES_USER

</code></pre></div></div>

<h2 id="creating-a-database">
<a class="anchor" href="#creating-a-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a database</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">test</span><span class="p">;</span>
</code></pre></div></div>

<p>Check it was created by running <code class="language-plaintext highlighter-rouge">\list</code></p>

<h2 id="connect-to-database">
<a class="anchor" href="#connect-to-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connect to database</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pgcli <span class="nt">-h</span> localhost <span class="nt">-p</span> PORT <span class="nt">-U</span> POSTGRES_USER TABLE_NAME
</code></pre></div></div>

<p>or run <code class="language-plaintext highlighter-rouge">\c TABLE_NAME</code></p>

<h2 id="dropping-a-database">
<a class="anchor" href="#dropping-a-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dropping a database</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">DATABASE</span> <span class="n">test</span><span class="p">;</span>
</code></pre></div></div>

<p><em>This is very dangerous</em></p>

<h2 id="create-table">
<a class="anchor" href="#create-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create table</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
    <span class="k">column_name</span> <span class="n">data_type</span> <span class="k">constraints</span><span class="p">(</span><span class="n">if</span> <span class="k">any</span><span class="p">)</span>
<span class="p">)</span>

</code></pre></div></div>

<p>Use <code class="language-plaintext highlighter-rouge">\d</code> (describe) to view a databases tables. Or <code class="language-plaintext highlighter-rouge">\d table_name</code> to see table.</p>

<p>See all <a href="https://www.postgresql.org/docs/current/datatype.html" target="\_blank">data types</a>.</p>

<h3 id="without-constraints">
<a class="anchor" href="#without-constraints" aria-hidden="true"><span class="octicon octicon-link"></span></a>without constraints</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
  <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
  <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
  <span class="n">date_of_birth</span> <span class="nb">DATE</span>
<span class="p">);</span>

</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+---------------+-----------------------+-----------+
| Column        | Type                  | Modifiers |
|---------------+-----------------------+-----------|
| <span class="nb">id</span>            | integer               |           |
| first_name    | character varying<span class="o">(</span>50<span class="o">)</span> |           |
| last_name     | character varying<span class="o">(</span>50<span class="o">)</span> |           |
| gender        | character varying<span class="o">(</span>7<span class="o">)</span>  |           |
| date_of_birth | <span class="nb">date</span>                  |           |
+---------------+-----------------------+-----------+
</code></pre></div></div>

<h3 id="with-constraints">
<a class="anchor" href="#with-constraints" aria-hidden="true"><span class="octicon octicon-link"></span></a>with constraints</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="n">date_of_birth</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+---------------+------------------------+------------------------------------------------------+
| Column        | Type                   | Modifiers                                            |
|---------------+------------------------+------------------------------------------------------|
| <span class="nb">id</span>            | bigint                 |  not null default nextval<span class="o">(</span><span class="s1">'person_id_seq'</span>::regclass<span class="o">)</span> |
| first_name    | character varying<span class="o">(</span>50<span class="o">)</span>  |  not null                                            |
| last_name     | character varying<span class="o">(</span>50<span class="o">)</span>  |  not null                                            |
| gender        | character varying<span class="o">(</span>7<span class="o">)</span>   |  not null                                            |
| date_of_birth | <span class="nb">date</span>                   |  not null                                            |
| email         | character varying<span class="o">(</span>150<span class="o">)</span> |                                                      |
+---------------+------------------------+------------------------------------------------------+
</code></pre></div></div>

<h2 id="drop-table">
<a class="anchor" href="#drop-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Drop table</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">table_name</span><span class="p">;</span>
</code></pre></div></div>

<p><em>This is very dangerous</em></p>

<h2 id="insert-into">
<a class="anchor" href="#insert-into" aria-hidden="true"><span class="octicon octicon-link"></span></a>Insert into</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">gender</span><span class="p">,</span>
  <span class="n">date_of_birth</span>
  <span class="c1">-- email -- not needed as it is nullable</span>
<span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'Anne'</span><span class="p">,</span> <span class="s1">'Smith'</span><span class="p">,</span> <span class="s1">'FEMALE'</span><span class="p">,</span> <span class="s1">'1988-01-09'</span> <span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">gender</span><span class="p">,</span>
  <span class="n">date_of_birth</span><span class="p">,</span>
  <span class="n">email</span>
<span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'Cornelius'</span><span class="p">,</span> <span class="s1">'Agrippa'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'1990-01-10'</span><span class="p">,</span> <span class="s1">'cagrippa@mail.com'</span> <span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">gender</span><span class="p">,</span>
  <span class="n">date_of_birth</span><span class="p">,</span>
  <span class="n">email</span>
<span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'Elizabeth'</span><span class="p">,</span> <span class="s1">'Lavenza'</span><span class="p">,</span> <span class="s1">'FEMALE'</span><span class="p">,</span> <span class="s1">'1985-08-10'</span><span class="p">,</span> <span class="s1">'lizzy_lav@mail.com'</span> <span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">person</span> <span class="p">(</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">gender</span><span class="p">,</span>
  <span class="n">date_of_birth</span><span class="p">,</span>
  <span class="n">email</span>
<span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span> <span class="s1">'Henry'</span><span class="p">,</span> <span class="s1">'Clerval'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'1989-03-21'</span><span class="p">,</span> <span class="s1">'hank_da_doc@mail.com'</span> <span class="p">);</span>

</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+----+------------+-----------+--------+---------------+----------------------+
| <span class="nb">id</span> | first_name | last_name | gender | date_of_birth | email                |
|----+------------+-----------+--------+---------------+----------------------|
| 1  | Anne       | Smith     | FEMALE | 1988-01-09    | &lt;null&gt;               |
| 2  | Cornelius  | Agrippa   | MALE   | 1990-01-10    | cagrippa@mail.com    |
| 3  | Elizabeth  | Lavenza   | FEMALE | 1985-08-10    | lizzy_lav@mail.com   |
| 4  | Henry      | Clerval   | MALE   | 1989-03-21    | hank_da_doc@mail.com |
+----+------------+-----------+--------+---------------+----------------------+
</code></pre></div></div>

<h3 id="generate-mock-data-from-file">
<a class="anchor" href="#generate-mock-data-from-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generate mock data from file</h3>

<p>Using <a href="https://www.mockaroo.com/">mockaroo</a> you can generate some data to play with.
View the downloaded file <a href="https://github.com/genzade/postGRES/blob/main/sql/person.sql" target="\_blank">here</a></p>

<p>Use this command to execute that file content.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">\</span><span class="n">i</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="selecting-from-table">
<a class="anchor" href="#selecting-from-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Selecting from table</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table</span><span class="p">;</span>                                 <span class="c1">-- select everything</span>
<span class="k">SELECT</span> <span class="n">col_a</span><span class="p">,</span> <span class="n">col_b</span> <span class="k">FROM</span> <span class="k">table_name</span><span class="p">;</span>                 <span class="c1">-- select particular columns</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col_a</span> <span class="k">ASC</span><span class="p">;</span>              <span class="c1">-- order by column (ascending)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col_a</span> <span class="k">DESC</span><span class="p">;</span>             <span class="c1">-- order by column (descending)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col_a</span><span class="p">,</span> <span class="n">col_b</span> <span class="k">DESC</span><span class="p">;</span>      <span class="c1">-- order by multiple column (descending)</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">col_a</span> <span class="k">FROM</span> <span class="k">table</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col_a</span> <span class="k">ASC</span><span class="p">;</span> <span class="c1">-- select distinct values</span>
</code></pre></div></div>

<h3 id="using-cluases">
<a class="anchor" href="#using-cluases" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using cluases</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="k">table</span>
    <span class="k">WHERE</span> <span class="n">col_a</span> <span class="o">=</span> <span class="s1">'some_value'</span><span class="p">;</span> <span class="c1">-- select everything matching criteria</span>

<span class="c1">-- multiple criteria with `AND`</span>
<span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="k">table</span>
    <span class="k">WHERE</span> <span class="n">col_a</span> <span class="o">=</span> <span class="s1">'some_value'</span>  <span class="c1">-- select everything matching criteria</span>
    <span class="k">AND</span> <span class="n">col_b</span> <span class="o">=</span> <span class="s1">'other_value'</span><span class="p">;</span>  <span class="c1">-- and other column value</span>

<span class="c1">-- multiple criteria with `OR`</span>
<span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="k">table</span>
    <span class="k">WHERE</span> <span class="n">col_a</span> <span class="o">=</span> <span class="s1">'some_value'</span>  <span class="c1">-- select everything matching criteria</span>
    <span class="k">AND</span> <span class="p">(</span>
        <span class="n">col_b</span> <span class="o">=</span> <span class="s1">'other_value'</span>
        <span class="k">OR</span>
        <span class="n">col_b</span> <span class="o">=</span> <span class="s1">'another_value'</span> <span class="c1">-- or this column value</span>
    <span class="p">);</span>
</code></pre></div></div>

<h3 id="comparison-operators">
<a class="anchor" href="#comparison-operators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Comparison operators</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | False    |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | False    |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&lt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">-- not equal operator</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | False    |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">1</span> <span class="o">&lt;&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | True     |</span>
<span class="c1">-- +----------+</span>
</code></pre></div></div>

<h3 id="limit-offset-and-fetch">
<a class="anchor" href="#limit-offset-and-fetch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limit, offset and fetch</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- LIMIT</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email            | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+------------------+------------------|</span>
<span class="c1">-- | 1  | Eadmund    | Dorsey    | MALE   | 2022-12-12    | &lt;null&gt;           | China            |</span>
<span class="c1">-- | 2  | Benjamen   | Garnson   | MALE   | 2023-03-18    | bgn1@deviart.com | Slovenia         |</span>
<span class="c1">-- | 3  | Sven       | Philipsen | MALE   | 2023-11-18    | spn2@jiahis.com  | Norway           |</span>
<span class="c1">-- | 4  | Mordy      | Albasini  | MALE   | 2023-09-25    | mi3@bc.co.uk     | Belarus          |</span>
<span class="c1">-- | 5  | Arley      | Naish     | MALE   | 2023-10-13    | ash4@recross.org | Portugal         |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>

<span class="c1">-- OFFSET</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">OFFSET</span> <span class="mi">5</span> <span class="k">LIMIT</span> <span class="mi">5</span><span class="p">;</span>

<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email            | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+------------------+------------------|</span>
<span class="c1">-- | 6  | Kim        | Enriques  | FEMALE | 2023-06-17    | keues5@tmall.com | Australia        |</span>
<span class="c1">-- | 7  | Amaleta    | Jamot     | FEMALE | 2023-09-02    | ajot6@huains.com | Jamaica          |</span>
<span class="c1">-- | 8  | Geoffrey   | Heasly    | MALE   | 2023-11-14    | ghesly7@est.com  | Guatemala        |</span>
<span class="c1">-- | 9  | Stavros    | Mapston   | MALE   | 2023-03-10    | saon8@st.tx.us   | Egypt            |</span>
<span class="c1">-- | 10 | Hebert     | Duckwith  | MALE   | 2023-02-27    | hith9@pla.or.jp  | Indonesia        |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>

<span class="c1">-- FETCH</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">OFFSET</span> <span class="mi">5</span> <span class="k">FETCH</span> <span class="k">FIRST</span> <span class="mi">5</span> <span class="k">ROWS</span> <span class="k">ONLY</span><span class="p">;</span>

<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email            | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+------------------+------------------|</span>
<span class="c1">-- | 6  | Kim        | Enriques  | FEMALE | 2023-06-17    | keues5@tmall.com | Australia        |</span>
<span class="c1">-- | 7  | Amaleta    | Jamot     | FEMALE | 2023-09-02    | ajot6@huains.com | Jamaica          |</span>
<span class="c1">-- | 8  | Geoffrey   | Heasly    | MALE   | 2023-11-14    | ghesly7@est.com  | Guatemala        |</span>
<span class="c1">-- | 9  | Stavros    | Mapston   | MALE   | 2023-03-10    | saon8@st.tx.us   | Egypt            |</span>
<span class="c1">-- | 10 | Hebert     | Duckwith  | MALE   | 2023-02-27    | hith9@pla.or.jp  | Indonesia        |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+------------------+------------------+</span>
</code></pre></div></div>

<h3 id="in">
<a class="anchor" href="#in" aria-hidden="true"><span class="octicon octicon-link"></span></a>In</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="k">table_name</span>
    <span class="k">WHERE</span> <span class="k">column</span> <span class="k">IN</span> <span class="p">(</span><span class="s1">'value_1'</span><span class="p">,</span> <span class="s1">'value_2'</span><span class="p">,</span> <span class="s1">'value_3'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="between">
<a class="anchor" href="#between" aria-hidden="true"><span class="octicon octicon-link"></span></a>Between</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="k">table_name</span>
    <span class="k">WHERE</span> <span class="n">date_column</span>
    <span class="k">BETWEEN</span> <span class="s1">'2000-01-01'</span> <span class="k">AND</span> <span class="s1">'2020-01-01'</span>
</code></pre></div></div>

<h3 id="like-and-ilike">
<a class="anchor" href="#like-and-ilike" aria-hidden="true"><span class="octicon octicon-link"></span></a>Like and iLike</h3>

<h4 id="wildcard-">
<a class="anchor" href="#wildcard-" aria-hidden="true"><span class="octicon octicon-link"></span></a>wildcard ‘%’</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- LIKE</span>
<span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="n">person</span>
    <span class="k">WHERE</span> <span class="n">email</span> <span class="k">LIKE</span> <span class="s1">'%.org'</span><span class="p">;</span> <span class="c1">-- anything that ends with '.org'</span>
<span class="c1">-- +-----+------------+------------+--------+---------------+----------------+------------------+</span>
<span class="c1">-- | id  | first_name | last_name  | gender | date_of_birth | email          | country_of_birth |</span>
<span class="c1">-- |-----+------------+------------+--------+---------------+----------------+------------------|</span>
<span class="c1">-- | 5   | Arley      | Naish      | MALE   | 2023-10-13    | anh4@rdss.org  | Portugal         |</span>
<span class="c1">-- | 79  | Abigael    | Blakesley  | FEMALE | 2023-04-17    | aby26@npr.org  | China            |</span>
<span class="c1">-- | 98  | Brock      | Axby       | MALE   | 2022-11-25    | yp@arhve.org   | Australia        |</span>
<span class="c1">-- | 111 | Daveta     | Bachelar   | FEMALE | 2023-07-17    | hela@pb.org    | Albania          |</span>
<span class="c1">-- | 120 | Malinde    | Stacey     | FEMALE | 2023-02-17    | syj@p.org      | Greece           |</span>
<span class="c1">-- | 123 | Lynn       | Brolechan  | FEMALE | 2023-08-29    | le@macin.org   | Japan            |</span>
<span class="c1">-- | 151 | Beryle     | Darbishire | FEMALE | 2023-05-26    | ire1e@pal.org  | China            |</span>
<span class="c1">-- +-----+------------+------------+--------+---------------+----------------+------------------+</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">email</span> <span class="k">LIKE</span> <span class="s1">'%google%'</span><span class="p">;</span> <span class="c1">-- use wildcard anywhere</span>
<span class="c1">-- +-----+------------+-----------+--------+---------------+-----------------+------------------+</span>
<span class="c1">-- | id  | first_name | last_name | gender | date_of_birth | email           | country_of_birth |</span>
<span class="c1">-- |-----+------------+-----------+--------+---------------+-----------------+------------------|</span>
<span class="c1">-- | 99  | Cynthy     | Kruger    | FEMALE | 2022-12-27    | ck2q@google.com | China            |</span>
<span class="c1">-- | 163 | Bendite    | Fowell    | FEMALE | 2023-08-18    | bf1q@google.com | China            |</span>
<span class="c1">-- | 191 | Vaughan    | Heasman   | MALE   | 2023-08-29    | vhn2i@google.ca | China            |</span>
<span class="c1">-- +-----+------------+-----------+--------+---------------+-----------------+------------------+</span>
</code></pre></div></div>

<h4 id="wildcard-_">
<a class="anchor" href="#wildcard-_" aria-hidden="true"><span class="octicon octicon-link"></span></a>wildcard ‘_’</h4>

<p>The _ character looks for a presence of (any) one single character.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="n">person</span>
    <span class="k">WHERE</span> <span class="n">email</span> <span class="k">LIKE</span> <span class="s1">'_______.org'</span><span class="p">;</span> <span class="c1">-- will return rows where email has 7 chars before '.org'</span>
</code></pre></div></div>

<h4 id="ilike-case-insensitive">
<a class="anchor" href="#ilike-case-insensitive" aria-hidden="true"><span class="octicon octicon-link"></span></a>iLike (case insensitive)</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ILIKE</span>
<span class="k">SELECT</span> <span class="o">*</span>
    <span class="k">FROM</span> <span class="n">person</span>
    <span class="k">WHERE</span> <span class="n">country_of_birth</span> <span class="k">ILIKE</span> <span class="s1">'i%'</span><span class="p">;</span> <span class="c1">-- will return rows where country_of_birth begins with i</span>
</code></pre></div></div>

<h3 id="group-by">
<a class="anchor" href="#group-by" aria-hidden="true"><span class="octicon octicon-link"></span></a>Group by</h3>

<p>Lets say you wanted to find out how many people you have in from each country in the database…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">country_of_birth</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">person</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country_of_birth</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">country_of_birth</span><span class="p">;</span>

<span class="c1">-- +-----------------------+-------+</span>
<span class="c1">-- | country_of_birth      | count |</span>
<span class="c1">-- |-----------------------+-------|</span>
<span class="c1">-- | Afghanistan           | 2     |</span>
<span class="c1">-- | Albania               | 2     |</span>
<span class="c1">-- | Argentina             | 2     |</span>
<span class="c1">-- | Armenia               | 1     |</span>
<span class="c1">-- | Australia             | 1     |</span>
<span class="c1">-- | Azerbaijan            | 1     |</span>
<span class="c1">-- ...</span>
</code></pre></div></div>

<h4 id="having">
<a class="anchor" href="#having" aria-hidden="true"><span class="octicon octicon-link"></span></a>Having</h4>

<p>Perform extra filtering after aggregation. e.g. find all countries that have at least 5 people…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">country_of_birth</span><span class="p">,</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">person</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">country_of_birth</span>
    <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">country_of_birth</span><span class="p">;</span>

<span class="c1">-- +------------------+-------+</span>
<span class="c1">-- | country_of_birth | count |</span>
<span class="c1">-- |------------------+-------|</span>
<span class="c1">-- | China            | 41    |</span>
<span class="c1">-- | France           | 6     |</span>
<span class="c1">-- | Indonesia        | 23    |</span>
<span class="c1">-- | Portugal         | 12    |</span>
<span class="c1">-- +------------------+-------+</span>
</code></pre></div></div>

<h2 id="adding-new-table">
<a class="anchor" href="#adding-new-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding new table</h2>

<p>See the <a href="https://github.com/genzade/postGRES/blob/main/sql/car.sql" target="\_blank">car sql file</a>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">\</span><span class="n">i</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="k">to</span><span class="o">/</span><span class="n">file</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>

<span class="c1">-- CREATE TABLE car (</span>
<span class="c1">--   id BIGSERIAL NOT NULL PRIMARY KEY,</span>
<span class="c1">--   make VARCHAR(100) NOT NULL,</span>
<span class="c1">--   model VARCHAR(100) NOT NULL,</span>
<span class="c1">--   price NUMERIC(19, 2) NOT NULL</span>
<span class="c1">-- );</span>
</code></pre></div></div>

<h2 id="calculations">
<a class="anchor" href="#calculations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Calculations</h2>

<h3 id="max">
<a class="anchor" href="#max" aria-hidden="true"><span class="octicon octicon-link"></span></a>Max</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | max      |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 99049.99 |</span>
<span class="c1">-- +----------+</span>

<span class="c1">-- select maximum price for each car make</span>
<span class="k">SELECT</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">car</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="min">
<a class="anchor" href="#min" aria-hidden="true"><span class="octicon octicon-link"></span></a>Min</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | min      |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 10470.60 |</span>
<span class="c1">-- +----------+</span>

<span class="c1">-- select minimum price for each car make</span>
<span class="k">SELECT</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="k">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">car</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="avg">
<a class="anchor" href="#avg" aria-hidden="true"><span class="octicon octicon-link"></span></a>Avg</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +--------------------+</span>
<span class="c1">-- | avg                |</span>
<span class="c1">-- |--------------------|</span>
<span class="c1">-- | 57763.456700000000 |</span>
<span class="c1">-- +--------------------+</span>

<span class="c1">-- round the result</span>
<span class="k">SELECT</span> <span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">))</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +-------+</span>
<span class="c1">-- | round |</span>
<span class="c1">-- |-------|</span>
<span class="c1">-- | 57763 |</span>
<span class="c1">-- +-------+</span>

<span class="c1">-- select minimum price for each car make</span>
<span class="k">SELECT</span> <span class="n">make</span><span class="p">,</span> <span class="n">ROUND</span><span class="p">(</span><span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">))</span>
    <span class="k">FROM</span> <span class="n">car</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">make</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="sum">
<a class="anchor" href="#sum" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sum</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- sum total price for all cars</span>
<span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +------------+</span>
<span class="c1">-- | sum        |</span>
<span class="c1">-- |------------|</span>
<span class="c1">-- | 5776345.67 |</span>
<span class="c1">-- +------------+</span>

<span class="c1">-- sum total by car make</span>
<span class="k">SELECT</span> <span class="n">make</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">car</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">make</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="arithmetic-operators">
<a class="anchor" href="#arithmetic-operators" aria-hidden="true"><span class="octicon octicon-link"></span></a>Arithmetic operators</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 3        |</span>
<span class="c1">-- +----------+</span>

 <span class="k">SELECT</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | -1       |</span>
<span class="c1">-- +----------+</span>

 <span class="k">SELECT</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 2        |</span>
<span class="c1">-- +----------+</span>

 <span class="k">SELECT</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 0        |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="mi">10</span> <span class="o">^</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 100.0    |</span>
<span class="c1">-- +----------+</span>

<span class="k">SELECT</span> <span class="n">factorial</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<span class="c1">-- +-----------+</span>
<span class="c1">-- | factorial |</span>
<span class="c1">-- |-----------|</span>
<span class="c1">-- | 3628800   |</span>
<span class="c1">-- +-----------+</span>

<span class="k">SELECT</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">3</span><span class="p">;</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 1        |</span>
<span class="c1">-- +----------+</span>
</code></pre></div></div>

<h3 id="round">
<a class="anchor" href="#round" aria-hidden="true"><span class="octicon octicon-link"></span></a>Round</h3>

<p>Lets say there was a promotion and we wanted to display the price of all cars as well as their discounted price…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="n">make</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">price</span> <span class="k">AS</span> <span class="n">original_price</span><span class="p">,</span>                           <span class="c1">-- alias original_price</span>
    <span class="n">ROUND</span><span class="p">(</span><span class="n">price</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">discounted_price</span><span class="p">,</span>         <span class="c1">-- alias discounted_price</span>
    <span class="n">ROUND</span><span class="p">((</span><span class="n">price</span> <span class="o">-</span> <span class="n">price</span> <span class="o">*</span> <span class="mi">0</span><span class="p">.</span><span class="mi">9</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span> <span class="k">AS</span> <span class="n">discount_amount</span> <span class="c1">-- alias discounted_price</span>
<span class="k">FROM</span> <span class="n">car</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">make</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="coalesce">
<a class="anchor" href="#coalesce" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coalesce</h3>

<p>You can hanle <code class="language-plaintext highlighter-rouge">NULL</code> values</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- will return the very first value that is present</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">number</span><span class="p">;</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | number |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 1      |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">number</span><span class="p">;</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | number |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 1      |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">number</span><span class="p">;</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | number |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 1      |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="k">AS</span> <span class="n">number</span><span class="p">;</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | number |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 1      |</span>
<span class="c1">-- +--------+</span>

<span class="k">SELECT</span>
    <span class="n">first_name</span><span class="p">,</span>
    <span class="n">last_name</span><span class="p">,</span>
    <span class="n">COALESCE</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="s1">'EMAIL NOT PROVIDED'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">email</span>
<span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +-------------+-----------------+-----------------------------------+</span>
<span class="c1">-- | first_name  | last_name       | email                             |</span>
<span class="c1">-- |-------------+-----------------+-----------------------------------|</span>
<span class="c1">-- | Eadmund     | Dorsey          | EMAIL NOT PROVIDED                |</span>
<span class="c1">-- | Benjamen    | Garnson         | bgarnson1@deviantart.com          |</span>
<span class="c1">-- | Sven        | Philipsen       | sphilipsen2@jiathis.com           |</span>
<span class="c1">-- | Geoffrey    | Heasly          | gheasly7@pinterest.com            |</span>
<span class="c1">-- | Stavros     | Mapston         | smapston8@state.tx.us             |</span>
<span class="c1">-- | Eolanda     | Kassman         | ekassmanb@furl.net                |</span>
<span class="c1">-- | Iolanthe    | Avramovsky      | EMAIL NOT PROVIDED                |</span>
<span class="c1">-- | Siana       | Woods           | EMAIL NOT PROVIDED                |</span>
<span class="c1">-- | Marina      | Crampton        | mcramptonc@bizjournals.com        |</span>
<span class="c1">-- | Domenico    | Kemston         | dkemstond@reference.com           |</span>
<span class="c1">-- | Putnam      | Pirot           | ppirote@goo.gl                    |</span>
<span class="c1">-- | Stern       | Oldacres        | EMAIL NOT PROVIDED                |</span>
<span class="c1">-- ...</span>
</code></pre></div></div>

<h3 id="nullif">
<a class="anchor" href="#nullif" aria-hidden="true"><span class="octicon octicon-link"></span></a>NULLIF</h3>

<p>Handle division by zero…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- NULLIF takes 2 args and return the first arg if provided args are not matching</span>
<span class="k">SELECT</span> <span class="mi">10</span> <span class="o">/</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">-- ERROR: division by zero</span>

<span class="k">SELECT</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | nullif |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | &lt;null&gt; |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | nullif |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 10     |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">19</span><span class="p">);</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | nullif |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 10     |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="c1">-- +--------+</span>
<span class="c1">-- | nullif |</span>
<span class="c1">-- |--------|</span>
<span class="c1">-- | 100    |</span>
<span class="c1">-- +--------+</span>
<span class="k">SELECT</span> <span class="mi">10</span> <span class="o">/</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 2        |</span>
<span class="c1">-- +----------+</span>
<span class="k">SELECT</span> <span class="mi">10</span> <span class="o">/</span> <span class="n">COALESCE</span><span class="p">(</span><span class="k">NULLIF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | ?column? |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | &lt;null&gt;   |</span>
<span class="c1">-- +----------+</span>
<span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="mi">10</span> <span class="o">/</span> <span class="k">NULLIF</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="c1">-- +----------+</span>
<span class="c1">-- | coalesce |</span>
<span class="c1">-- |----------|</span>
<span class="c1">-- | 0        |</span>
<span class="c1">-- +----------+</span>
</code></pre></div></div>

<h2 id="timastamps-and-dates">
<a class="anchor" href="#timastamps-and-dates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Timastamps and dates</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">NOW</span><span class="p">();</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | now                           |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-11-26 17:29:40.635535+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()::</span><span class="nb">DATE</span> <span class="k">AS</span> <span class="k">current_date</span><span class="p">;</span> <span class="c1">-- cast to date</span>
<span class="c1">-- +--------------+</span>
<span class="c1">-- | current_date |</span>
<span class="c1">-- |--------------|</span>
<span class="c1">-- | 2023-11-26   |</span>
<span class="c1">-- +--------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()::</span><span class="nb">TIME</span> <span class="k">AS</span> <span class="k">current_time</span><span class="p">;</span> <span class="c1">-- cast to time</span>
<span class="c1">-- +-----------------+</span>
<span class="c1">-- | current_time    |</span>
<span class="c1">-- |-----------------|</span>
<span class="c1">-- | 17:29:40.645954 |</span>
<span class="c1">-- +-----------------+</span>
</code></pre></div></div>

<p>Check out the <a href="https://www.postgresql.org/docs/16/datatype-datetime.html" target="\_blank">docs</a>
for more.</p>

<h3 id="adding-and-subtracting-with-dates-interval">
<a class="anchor" href="#adding-and-subtracting-with-dates-interval" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding and subtracting with dates (INTERVAL)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
 <span class="c1">-- ADDING</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'1 day'</span><span class="p">;</span>     <span class="c1">-- 1 day from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-11-27 21:59:42.626857+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'10 days'</span><span class="p">;</span>   <span class="c1">-- 10 days from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-12-06 21:59:42.632817+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'1 month'</span><span class="p">;</span>   <span class="c1">-- 1 month from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-12-26 21:59:42.635898+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'10 months'</span><span class="p">;</span> <span class="c1">-- 10 months from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2024-09-26 21:59:42.639113+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'1 year'</span><span class="p">;</span>    <span class="c1">-- 1 year from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2024-11-26 21:59:42.642619+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'10 years'</span><span class="p">;</span>  <span class="c1">-- 10 years from now</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2033-11-26 21:59:42.645611+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- SUBTRACTING</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'1 day'</span><span class="p">;</span>     <span class="c1">-- 1 day ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-11-25 21:59:42.648543+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'10 days'</span><span class="p">;</span>   <span class="c1">-- 10 days ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-11-16 21:59:42.651517+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'1 month'</span><span class="p">;</span>   <span class="c1">-- 1 month ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-10-26 21:59:42.654834+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'10 months'</span><span class="p">;</span> <span class="c1">-- 10 months ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2023-01-26 21:59:42.658143+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'1 year'</span><span class="p">;</span>    <span class="c1">-- 1 year ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2022-11-26 21:59:42.661703+00 |</span>
<span class="c1">-- +-------------------------------+</span>
<span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'10 years'</span><span class="p">;</span>  <span class="c1">-- 10 years ago</span>
<span class="c1">-- +-------------------------------+</span>
<span class="c1">-- | ?column?                      |</span>
<span class="c1">-- |-------------------------------|</span>
<span class="c1">-- | 2013-11-26 21:59:42.665242+00 |</span>
<span class="c1">-- +-------------------------------+</span>
</code></pre></div></div>

<p>If you want just the date you can caste it like so…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="p">(</span><span class="n">NOW</span><span class="p">()</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'10 years'</span><span class="p">)::</span><span class="nb">DATE</span><span class="p">;</span>  <span class="c1">-- 10 years from now</span>
<span class="c1">-- +------------+</span>
<span class="c1">-- | date       |</span>
<span class="c1">-- |------------|</span>
<span class="c1">-- | 2033-11-26 |</span>
<span class="c1">-- +------------+</span>
<span class="k">SELECT</span> <span class="p">(</span><span class="n">NOW</span><span class="p">()</span> <span class="o">-</span> <span class="n">INTERVAL</span> <span class="s1">'10 years'</span><span class="p">)::</span><span class="nb">DATE</span><span class="p">;</span>  <span class="c1">-- 10 years ago</span>
<span class="c1">-- +------------+</span>
<span class="c1">-- | date       |</span>
<span class="c1">-- |------------|</span>
<span class="c1">-- | 2013-11-26 |</span>
<span class="c1">-- +------------+</span>
</code></pre></div></div>

<h3 id="extracting-fields">
<a class="anchor" href="#extracting-fields" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extracting fields</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">-- just for reference for below table</span>
<span class="k">SELECT</span> <span class="n">NOw</span><span class="p">()::</span><span class="nb">DATE</span><span class="p">;</span>
<span class="c1">-- +------------+</span>
<span class="c1">-- | now        |</span>
<span class="c1">-- |------------|</span>
<span class="c1">-- | 2023-11-26 |</span>
<span class="c1">-- +------------+</span>

<span class="k">SELECT</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="nb">YEAR</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="nb">year</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="k">MONTH</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="k">month</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="k">DAY</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="k">day</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="n">DOW</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="n">day_of_week</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="n">HOUR</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="n">hour</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="k">MINUTE</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="k">minute</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="k">SECOND</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="k">second</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="n">MICROSECOND</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="n">microsecond</span><span class="p">,</span>
    <span class="k">EXTRACT</span><span class="p">(</span><span class="n">WEEK</span> <span class="k">FROM</span> <span class="n">NOW</span><span class="p">())</span> <span class="k">AS</span> <span class="n">week</span><span class="p">;</span>
<span class="c1">-- +------+-------+-----+-------------+------+--------+-----------+-------------+------+</span>
<span class="c1">-- | year | month | day | day_of_week | hour | minute | second    | microsecond | week |</span>
<span class="c1">-- |------+-------+-----+-------------+------+--------+-----------+-------------+------|</span>
<span class="c1">-- | 2023 | 11    | 26  | 0           | 22   | 24     | 35.083122 | 35083122    | 47   |</span>
<span class="c1">-- +------+-------+-----+-------------+------+--------+-----------+-------------+------+</span>
</code></pre></div></div>

<h2 id="age-function">
<a class="anchor" href="#age-function" aria-hidden="true"><span class="octicon octicon-link"></span></a>Age function</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="n">first_name</span><span class="p">,</span>
    <span class="n">last_name</span><span class="p">,</span>
    <span class="n">gender</span><span class="p">,</span>
    <span class="n">date_of_birth</span><span class="p">,</span>
    <span class="n">AGE</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span>
    <span class="n">date_of_birth</span><span class="p">)</span> <span class="k">AS</span> <span class="n">age</span>
<span class="k">FROM</span> <span class="n">person</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;;</span>
<span class="c1">-- +------------+-----------+--------+---------------+--------------------------+</span>
<span class="c1">-- | first_name | last_name | gender | date_of_birth | age                      |</span>
<span class="c1">-- |------------+-----------+--------+---------------+--------------------------|</span>
<span class="c1">-- | Eadmund    | Dorsey    | MALE   | 2022-12-12    | 345 days, 0:19:49.144054 |</span>
<span class="c1">-- | Benjamen   | Garnson   | MALE   | 2023-03-18    | 249 days, 0:19:49.144054 |</span>
<span class="c1">-- | Sven       | Philipsen | MALE   | 2023-11-18    | 9 days, 0:19:49.144054   |</span>
<span class="c1">-- | Mordy      | Albasini  | MALE   | 2023-09-25    | 62 days, 0:19:49.144054  |</span>
<span class="c1">-- | Arley      | Naish     | MALE   | 2023-10-13    | 44 days, 0:19:49.144054  |</span>
<span class="c1">-- | Kim        | Enriques  | FEMALE | 2023-06-17    | 160 days, 0:19:49.144054 |</span>
<span class="c1">-- | Amaleta    | Jamot     | FEMALE | 2023-09-02    | 85 days, 0:19:49.144054  |</span>
<span class="c1">-- | Geoffrey   | Heasly    | MALE   | 2023-11-14    | 13 days, 0:19:49.144054  |</span>
<span class="c1">-- | Stavros    | Mapston   | MALE   | 2023-03-10    | 257 days, 0:19:49.144054 |</span>
<span class="c1">-- | Hebert     | Duckwith  | MALE   | 2023-02-27    | 270 days, 0:19:49.144054 |</span>
<span class="c1">-- +------------+-----------+--------+---------------+--------------------------+</span>
</code></pre></div></div>

<h2 id="primary-key">
<a class="anchor" href="#primary-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Primary key</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span>
  <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'EAdmund'</span><span class="p">,</span> <span class="s1">'Dorsey'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2022/12/12'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">);</span>

<span class="c1">-- duplicate key value violates unique constraint "person_pkey"</span>
<span class="c1">-- DETAIL:  Key (id)=(1) already exists.</span>
</code></pre></div></div>

<h3 id="alter-table">
<a class="anchor" href="#alter-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>Alter table</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- remove the primary key constraint</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span>
    <span class="k">DROP</span> <span class="k">CONSTRAINT</span> <span class="n">person_pkey</span><span class="p">;</span>

<span class="c1">-- now the insert statement from before should work</span>
<span class="k">INSERT</span> <span class="k">INTO</span>
   <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
 <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'EAdmund'</span><span class="p">,</span> <span class="s1">'Dorsey'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2022/12/12'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">);</span>

<span class="c1">--- INSERT 0 1</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email  | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+--------+------------------|</span>
<span class="c1">-- | 1  | Eadmund    | Dorsey    | MALE   | 2022-12-12    | &lt;null&gt; | China            |</span>
<span class="c1">-- | 1  | EAdmund    | Dorsey    | MALE   | 2022-12-12    | &lt;null&gt; | China            |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>
</code></pre></div></div>

<p>This should show the importance of primary key contraints as without it we can not distinguish between the 2 records returned.</p>

<h3 id="adding-primary-key">
<a class="anchor" href="#adding-primary-key" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding primary key</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">--- add back the primary key</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>
<span class="c1">-- could not create unique index "person_pkey"</span>
<span class="c1">-- DETAIL:  Key (id)=(1) is duplicated.</span>
</code></pre></div></div>

<p>We have to delete those records before adding back the constraint.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+-------+------------------|</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>
</code></pre></div></div>

<p>Now that person can be added back…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span>
   <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'EAdmund'</span><span class="p">,</span> <span class="s1">'Dorsey'</span><span class="p">,</span> <span class="k">NULL</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2022/12/12'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">);</span>

<span class="c1">-- INSERT 0 1</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email  | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+--------+------------------|</span>
<span class="c1">-- | 1  | EAdmund    | Dorsey    | MALE   | 2022-12-12    | &lt;null&gt; | China            |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>
</code></pre></div></div>

<p>Now we can add the primary key constraint…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="unique-constraints">
<a class="anchor" href="#unique-constraints" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unique constraints</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">email</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">email</span><span class="p">;</span>
<span class="c1">-- +-----------------------------------+-------+</span>
<span class="c1">-- | email                             | count |</span>
<span class="c1">-- |-----------------------------------+-------|</span>
<span class="c1">-- | telcox15@phoca.cz                 | 1     |</span>
<span class="c1">-- | sstoeck1p@amazon.co.uk            | 1     |</span>
<span class="c1">-- | &lt;null&gt;                            | 53    |</span>
<span class="c1">-- | etrundler1q@homestead.com         | 1     |</span>
<span class="c1">-- | cgranleesey@aboutads.info         | 1     |</span>
<span class="c1">-- | tpovele10@wsj.com                 | 1     |</span>
<span class="c1">-- ...</span>

<span class="c1">-- check for duplicate emails</span>
<span class="k">SELECT</span> <span class="n">email</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">email</span> <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +--------+-------+</span>
<span class="c1">-- | email  | count |</span>
<span class="c1">-- |--------+-------|</span>
<span class="c1">-- | &lt;null&gt; | 53    |</span>
<span class="c1">-- +--------+-------+</span>
</code></pre></div></div>

<p>Lets add another record…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Sammy'</span><span class="p">,</span> <span class="s1">'Albasini'</span><span class="p">,</span> <span class="s1">'sini3@bbc.co.uk'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/09/25'</span><span class="p">,</span> <span class="s1">'Belarus'</span><span class="p">);</span>

<span class="c1">-- now we have a duplicate</span>

<span class="k">SELECT</span> <span class="n">email</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">email</span> <span class="k">HAVING</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----------------------+-------+</span>
<span class="c1">-- | email                | count |</span>
<span class="c1">-- |----------------------+-------|</span>
<span class="c1">-- | &lt;null&gt;               | 53    |</span>
<span class="c1">-- | sini3@bbc.co.uk | 2     |</span>
<span class="c1">-- +----------------------+-------+</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">email</span> <span class="o">=</span> <span class="s1">'sini3@bbc.co.uk'</span><span class="p">;</span>
<span class="c1">-- +-----+------------+-----------+--------+---------------+-----------------+------------------+</span>
<span class="c1">-- | id  | first_name | last_name | gender | date_of_birth | email           | country_of_birth |</span>
<span class="c1">-- |-----+------------+-----------+--------+---------------+-----------------+------------------|</span>
<span class="c1">-- | 4   | Mordy      | Albasini  | MALE   | 2023-09-25    | sini3@bbc.co.uk | Belarus          |</span>
<span class="c1">-- | 201 | Sammy      | Albasini  | MALE   | 2023-09-25    | sini3@bbc.co.uk | Belarus          |</span>
<span class="c1">-- +-----+------------+-----------+--------+---------------+-----------------+------------------+</span>
</code></pre></div></div>

<p>Lets add the unique constraint…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">--- add unique email constraint to person table</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">unique_email_address</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">);</span>
<span class="c1">-- could not create unique index "unique_email_address"</span>
<span class="c1">-- DETAIL:  Key (email)=(sini3@bbc.co.uk) is duplicated.</span>

<span class="c1">-- another way of adding constraint</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">);</span> <span class="c1">-- this way postgres adds the name of the constraint</span>
</code></pre></div></div>

<p>Lets fix that</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">201</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">email</span> <span class="o">=</span> <span class="s1">'sini3@bbc.co.uk'</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+-------+------------------|</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">unique_email_address</span> <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">);</span>

<span class="err">\</span><span class="n">d</span> <span class="n">person</span>
<span class="c1">-- ...</span>
<span class="c1">-- Indexes:</span>
<span class="c1">--     "person_pkey" PRIMARY KEY, btree (id)</span>
<span class="c1">--     "unique_email_address" UNIQUE CONSTRAINT, btree (email)</span>

<span class="c1">-- now we can not add that record again</span>
<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Sammy'</span><span class="p">,</span> <span class="s1">'Albasini'</span><span class="p">,</span> <span class="s1">'sini3@bbc.co.uk'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/09/25'</span><span class="p">,</span> <span class="s1">'Belarus'</span><span class="p">);</span>
<span class="c1">-- duplicate key value violates unique constraint "unique_email_address"</span>
<span class="c1">-- DETAIL:  Key (email)=(sini3@bbc.co.uk) already exists.</span>
</code></pre></div></div>

<h2 id="primary-key-vs-unique-constraint">
<a class="anchor" href="#primary-key-vs-unique-constraint" aria-hidden="true"><span class="octicon octicon-link"></span></a>Primary key vs Unique constraint</h2>

<p><code class="language-plaintext highlighter-rouge">Primary ensures</code> unique rows and <code class="language-plaintext highlighter-rouge">Unique constraint</code> ensures unique values in column.</p>

<h2 id="check-constraint">
<a class="anchor" href="#check-constraint" aria-hidden="true"><span class="octicon octicon-link"></span></a>Check constraint</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">ALTER</span> <span class="k">TABLE</span>
    <span class="n">person</span>
<span class="k">ADD</span> <span class="k">CONSTRAINT</span> <span class="n">gender_constraint</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">gender</span> <span class="o">=</span> <span class="s1">'MALE'</span> <span class="k">OR</span> <span class="n">gender</span> <span class="o">=</span> <span class="s1">'FEMALE'</span><span class="p">);</span>

<span class="c1">-- now gender can only be 'MALE' OR gender = 'FEMALE'</span>

<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Sammy'</span><span class="p">,</span> <span class="s1">'sini'</span><span class="p">,</span> <span class="s1">'sini3@bbc.co.uk'</span><span class="p">,</span> <span class="s1">'helloooooooo'</span><span class="p">,</span> <span class="s1">'2023/09/25'</span><span class="p">,</span> <span class="s1">'Belarus'</span><span class="p">);</span>
<span class="c1">-- check constraint "gender_constraint" of relation "person" is violated by some row</span>
</code></pre></div></div>

<h2 id="delete-records">
<a class="anchor" href="#delete-records" aria-hidden="true"><span class="octicon octicon-link"></span></a>Delete records</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- delete everyone</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>

<span class="c1">-- delete person with id 42</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+-------+------------------|</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-------+------------------+</span>

<span class="c1">-- can use multiple conditions in where clause</span>

<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">gender</span> <span class="o">=</span> <span class="s1">'MALE'</span> <span class="k">AND</span> <span class="n">country_of_birth</span> <span class="o">=</span> <span class="s1">'Peru'</span><span class="p">;</span>
<span class="c1">-- +-------+</span>
<span class="c1">-- | count |</span>
<span class="c1">-- |-------|</span>
<span class="c1">-- | 2     |</span>
<span class="c1">-- +-------+</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">gender</span> <span class="o">=</span> <span class="s1">'MALE'</span> <span class="k">AND</span> <span class="n">country_of_birth</span> <span class="o">=</span> <span class="s1">'Peru'</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">gender</span> <span class="o">=</span> <span class="s1">'MALE'</span> <span class="k">AND</span> <span class="n">country_of_birth</span> <span class="o">=</span> <span class="s1">'Peru'</span><span class="p">;</span>
<span class="c1">-- +-------+</span>
<span class="c1">-- | count |</span>
<span class="c1">-- |-------|</span>
<span class="c1">-- | 0     |</span>
<span class="c1">-- +-------+</span>
</code></pre></div></div>

<h2 id="update-records">
<a class="anchor" href="#update-records" aria-hidden="true"><span class="octicon octicon-link"></span></a>Update records</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email  | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+--------+------------------|</span>
<span class="c1">-- | 1  | EAdmund    | Dorsey    | MALE   | 2022-12-12    | &lt;null&gt; | China            |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+--------+------------------+</span>

<span class="c1">-- add an email to this guy</span>
<span class="k">UPDATE</span> <span class="n">person</span> <span class="k">SET</span> <span class="n">email</span> <span class="o">=</span> <span class="s1">'edorsey@mail.com'</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">email</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------------+</span>
<span class="c1">-- | id | email            |</span>
<span class="c1">-- |----+------------------|</span>
<span class="c1">-- | 1  | edorsey@mail.com |</span>
<span class="c1">-- +----+------------------+</span>

<span class="c1">-- you can update</span>
<span class="k">UPDATE</span> <span class="n">person</span> <span class="k">SET</span> <span class="n">first_name</span> <span class="o">=</span> <span class="s1">'Ed'</span><span class="p">,</span> <span class="n">last_name</span> <span class="o">=</span> <span class="s1">'Dorsy'</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+</span>
<span class="c1">-- | id | first*name | last*name |</span>
<span class="c1">-- |----+------------+-----------|</span>
<span class="c1">-- | 1  | Ed         | Dorsy     |</span>
<span class="c1">-- +----+------------+-----------+</span>
</code></pre></div></div>

<h3 id="note-about-updating">
<a class="anchor" href="#note-about-updating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Note about updating</h3>

<p>Make sure you specify a ‘WHERE’ clause as omitting it would update the entire table.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">person</span> <span class="k">SET</span> <span class="n">email</span> <span class="o">=</span> <span class="s1">'edorsey@mail.com'</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">-- only updates EAdmund</span>

<span class="k">UPDATE</span> <span class="n">person</span> <span class="k">SET</span> <span class="n">email</span> <span class="o">=</span> <span class="s1">'edorsey@mail.com'</span><span class="p">;</span>              <span class="c1">-- updates all rows</span>
</code></pre></div></div>

<h2 id="on-conflict-do-nothing">
<a class="anchor" href="#on-conflict-do-nothing" aria-hidden="true"><span class="octicon octicon-link"></span></a>On conflict, do nothing</h2>

<p>Lets handle things like exceptions or <code class="language-plaintext highlighter-rouge">duplicate key errors</code>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-----------------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email           | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+-----------------+------------------|</span>
<span class="c1">-- | 31 | Marietta   | Nadin     | MALE   | 2023-05-23    | mnadinu@psu.edu | China            |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-----------------+------------------+</span>

<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Marietta'</span><span class="p">,</span> <span class="s1">'Nadin'</span><span class="p">,</span> <span class="s1">'mnadinu@psu.edu'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/05/23'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">);</span>
<span class="c1">-- duplicate key value violates unique constraint "unique_email_address"</span>
<span class="c1">-- DETAIL:  Key (email)=(mnadinu@psu.edu) already exists.</span>

<span class="c1">-- we can handle exceptions with `ON CNFLICT`</span>
<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="s1">'Marietta'</span><span class="p">,</span> <span class="s1">'Nadin'</span><span class="p">,</span> <span class="s1">'mnadinu@psu.edu'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/05/23'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span><span class="p">;</span>

<span class="c1">-- INSERT 0 0                               -- Note no inserts</span>
<span class="c1">-- Time: 0.009sN CONFLICT (id) DO NOTHING;</span>

<span class="c1">-- ensure that ON CONFLICT takes a column that has a constraint</span>
<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">31</span><span class="p">,</span> <span class="s1">'Marietta'</span><span class="p">,</span> <span class="s1">'Nadin'</span><span class="p">,</span> <span class="s1">'mnadinu@psu.edu'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/05/23'</span><span class="p">,</span> <span class="s1">'China'</span><span class="p">)</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">first_name</span><span class="p">)</span> <span class="k">DO</span> <span class="k">NOTHING</span><span class="p">;</span>

<span class="c1">-- there is no unique or exclusion constraint matching the ON CONFLICT specification</span>
</code></pre></div></div>

<h2 id="upsert">
<a class="anchor" href="#upsert" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upsert</h2>

<p>Imagine 2 inserts happen consecutively but the user changes, for example, the email.
We can assume the latest submitted email is the correct one…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+----------------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email          | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+----------------+------------------|</span>
<span class="c1">-- | 15 | Putnam     | Pirot     | MALE   | 2023-06-04    | ppirote@goo.gl | Indonesia        |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+----------------+------------------+</span>

<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">,</span> <span class="n">country_of_birth</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s1">'Putnam'</span><span class="p">,</span> <span class="s1">'Pirot'</span><span class="p">,</span> <span class="s1">'pp@goo.gl'</span><span class="p">,</span> <span class="s1">'MALE'</span><span class="p">,</span> <span class="s1">'2023/06/04'</span><span class="p">,</span> <span class="s1">'Indonesia'</span><span class="p">);</span>
<span class="k">ON</span> <span class="n">CONFLICT</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">DO</span> <span class="k">UPDATE</span> <span class="k">SET</span> <span class="n">email</span> <span class="o">=</span> <span class="n">EXCLUDED</span><span class="p">.</span><span class="n">email</span><span class="p">;</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- Time: 0.021s</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-----------+------------------+</span>
<span class="c1">-- | id | first_name | last_name | gender | date_of_birth | email     | country_of_birth |</span>
<span class="c1">-- |----+------------+-----------+--------+---------------+-----------+------------------|</span>
<span class="c1">-- | 15 | Putnam     | Pirot     | MALE   | 2023-06-04    | pp@goo.gl | Indonesia        |</span>
<span class="c1">-- +----+------------+-----------+--------+---------------+-----------+------------------+</span>
</code></pre></div></div>

<h2 id="foreign-keys-joins-and-relationships">
<a class="anchor" href="#foreign-keys-joins-and-relationships" aria-hidden="true"><span class="octicon octicon-link"></span></a>Foreign keys, joins and relationships</h2>

<p>A foreign key in one table references a primary key in another table. This is a relationship.</p>

<p>We currently have two tables; <code class="language-plaintext highlighter-rouge">person</code> and <code class="language-plaintext highlighter-rouge">car</code> and we want to establish a relationship
between them as follows;</p>

<ul>
  <li>A <code class="language-plaintext highlighter-rouge">person</code> has one <code class="language-plaintext highlighter-rouge">car</code> (can only have one car)</li>
  <li>A car <code class="language-plaintext highlighter-rouge">can</code> only belong to one <code class="language-plaintext highlighter-rouge">person</code>
</li>
</ul>

<h3 id="adding-relationships-between-tables">
<a class="anchor" href="#adding-relationships-between-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adding relationships between tables</h3>

<p>If we were to rewrite the <code class="language-plaintext highlighter-rouge">person</code> and <code class="language-plaintext highlighter-rouge">car</code> tables with respect to the reltionship described above…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">car</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">make</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">model</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
    <span class="n">id</span> <span class="n">BIGSERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">dob</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">country</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">car_id</span> <span class="nb">BIGINT</span> <span class="k">REFERENCES</span> <span class="n">car</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">car_id</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>See <a href="https://github.com/genzade/postGRES/blob/main/sql/person-car.sql" target="\_blank">person-car.sql file</a>.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- You're about to run a destructive command.</span>
<span class="c1">-- Do you want to proceed? [y/N]: y</span>
<span class="c1">-- Your call!</span>
<span class="c1">-- DROP TABLE</span>
<span class="c1">-- Time: 0.030s</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- You're about to run a destructive command.</span>
<span class="c1">-- Do you want to proceed? [y/N]: y</span>
<span class="c1">-- Your call!</span>
<span class="c1">-- DROP TABLE</span>
<span class="c1">-- Time: 0.014s</span>

<span class="err">\</span><span class="n">i</span> <span class="k">sql</span><span class="o">/</span><span class="n">person</span><span class="o">-</span><span class="n">car</span><span class="p">.</span><span class="k">sql</span>
<span class="c1">-- CREATE TABLE</span>
<span class="c1">-- CREATE TABLE</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- Time: 0.055s</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+----------------+------------+---------+--------+</span>
<span class="c1">-- | id | first_name | last_name | gender | email          | dob        | country | car_id |</span>
<span class="c1">-- |----+------------+-----------+--------+----------------+------------+---------+--------|</span>
<span class="c1">-- | 1  | Fernanda   | Beardon   | Female | nandab@is.gd   | 1953-10-28 | Comoros | &lt;null&gt; |</span>
<span class="c1">-- | 2  | Omar       | Colmore   | Male   | &lt;null&gt;         | 1921-04-03 | Finland | &lt;null&gt; |</span>
<span class="c1">-- | 3  | John       | Matuschek | Male   | jon@fdbrnr.com | 1965-02-28 | England | &lt;null&gt; |</span>
<span class="c1">-- +----+------------+-----------+--------+----------------+------------+---------+--------+</span>
<span class="c1">-- SELECT 3</span>
<span class="c1">-- Time: 0.017s</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +----+------------+----------+----------+</span>
<span class="c1">-- | id | make       | model    | price    |</span>
<span class="c1">-- |----+------------+----------+----------|</span>
<span class="c1">-- | 1  | Land Rover | Sterling | 87665.38 |</span>
<span class="c1">-- | 2  | GMC        | Acadia   | 17662.69 |</span>
<span class="c1">-- +----+------------+----------+----------+</span>
<span class="c1">-- SELECT 2</span>
</code></pre></div></div>

<h3 id="updating-foreign-keys-columns">
<a class="anchor" href="#updating-foreign-keys-columns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Updating foreign keys columns</h3>

<p>Lets assign two cars to two people…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="n">person</span>
<span class="k">SET</span> <span class="n">car_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">-- GMC</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">-- Fernanda</span>
<span class="c1">-- UPDATE 1</span>
<span class="c1">-- Time: 0.035s</span>

<span class="c1">-- see the unique constraint work</span>
<span class="k">UPDATE</span> <span class="n">person</span>
<span class="k">SET</span> <span class="n">car_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">-- GMC</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">-- Omar</span>
<span class="c1">-- duplicate key value violates unique constraint "person_car_id_key"</span>
<span class="c1">-- DETAIL:  Key (car_id)=(2) already exists.</span>

<span class="k">UPDATE</span> <span class="n">person</span>
<span class="k">SET</span> <span class="n">car_id</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">-- GMC</span>
<span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">-- Omar</span>
<span class="c1">-- UPDATE 1</span>
<span class="c1">-- Time: 0.021s</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>

<span class="c1">-- +----+------------+-----------+--------+----------------+------------+---------+--------+</span>
<span class="c1">-- | id | first_name | last_name | gender | email          | dob        | country | car_id |</span>
<span class="c1">-- |----+------------+-----------+--------+----------------+------------+---------+--------|</span>
<span class="c1">-- | 3  | John       | Matuschek | Male   | jon@fdbrnr.com | 1965-02-28 | England | &lt;null&gt; |</span>
<span class="c1">-- | 1  | Fernanda   | Beardon   | Female | nandab@is.gd   | 1953-10-28 | Comoros | 2      |</span>
<span class="c1">-- | 2  | Omar       | Colmore   | Male   | &lt;null&gt;         | 1921-04-03 | Finland | 1      |</span>
<span class="c1">-- +----+------------+-----------+--------+----------------+------------+---------+--------+</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +----+------------+----------+----------+</span>
<span class="c1">-- | id | make       | model    | price    |</span>
<span class="c1">-- |----+------------+----------+----------|</span>
<span class="c1">-- | 1  | Land Rover | Sterling | 87665.38 |</span>
<span class="c1">-- | 2  | GMC        | Acadia   | 17662.69 |</span>
<span class="c1">-- +----+------------+----------+----------+</span>
<span class="c1">-- SELECT 2</span>
</code></pre></div></div>

<h2 id="inner-joins">
<a class="anchor" href="#inner-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inner joins</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="n">first_name</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span>
<span class="k">FROM</span> <span class="n">person</span>
<span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">-- INNER JOIN car ON person.car_id = car.id; -- same as above</span>

<span class="c1">-- +------------+------------+----------+----------+</span>
<span class="c1">-- | first_name | make       | model    | price    |</span>
<span class="c1">-- |------------+------------+----------+----------|</span>
<span class="c1">-- | Omar       | Land Rover | Sterling | 87665.38 |</span>
<span class="c1">-- | Fernanda   | GMC        | Acadia   | 17662.69 |</span>
<span class="c1">-- +------------+------------+----------+----------+</span>
</code></pre></div></div>

<h2 id="left-joins">
<a class="anchor" href="#left-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Left joins</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
    <span class="n">first_name</span><span class="p">,</span> <span class="n">make</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">price</span>
<span class="k">FROM</span> <span class="n">person</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
<span class="c1">-- +------------+------------+----------+----------+</span>
<span class="c1">-- | first_name | make       | model    | price    |</span>
<span class="c1">-- |------------+------------+----------+----------|</span>
<span class="c1">-- | Omar       | Land Rover | Sterling | 87665.38 |</span>
<span class="c1">-- | Fernanda   | GMC        | Acadia   | 17662.69 |</span>
<span class="c1">-- | John       | &lt;null&gt;     | &lt;null&gt;   | &lt;null&gt;   |</span>
<span class="c1">-- +------------+------------+----------+----------+</span>
</code></pre></div></div>

<h2 id="deleting-records-with-foreingn-keys">
<a class="anchor" href="#deleting-records-with-foreingn-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deleting records with foreingn keys</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">car</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- update or delete on table "car" violates foreign key constraint ,,,</span>
<span class="c1">-- DETAIL:  Key (id)=(2) is still referenced from table "person".</span>
</code></pre></div></div>

<p>To achieve this you could first <code class="language-plaintext highlighter-rouge">DELETE</code> the <code class="language-plaintext highlighter-rouge">person</code> the car belongs to…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">WHERE</span> <span class="n">car_id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">-- then</span>
<span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">car</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="exporting-query-results-to-csv">
<a class="anchor" href="#exporting-query-results-to-csv" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exporting query results to CSV</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">\</span><span class="k">copy</span> <span class="p">(</span>
     <span class="k">SELECT</span> <span class="o">*</span>
     <span class="k">FROM</span> <span class="n">person</span>
     <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_id</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">id</span>
 <span class="p">)</span> <span class="k">TO</span> <span class="s1">'/path/to/file.csv'</span> <span class="n">CSV</span> <span class="n">HEADER</span><span class="p">;</span> <span class="c1">-- include headers</span>
</code></pre></div></div>

<h2 id="serial-and-sequences">
<a class="anchor" href="#serial-and-sequences" aria-hidden="true"><span class="octicon octicon-link"></span></a>Serial and sequences</h2>

<p><code class="language-plaintext highlighter-rouge">BIGSERIAL</code> is a special data type that auto increments a number (<code class="language-plaintext highlighter-rouge">integer</code>).</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">\</span><span class="n">d</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +------------+------------------------+------------------------------------------------------+</span>
<span class="c1">-- | Column     | Type                   | Modifiers                                            |</span>
<span class="c1">-- |------------+------------------------+------------------------------------------------------|</span>
<span class="c1">-- | id         | bigint                 |  not null default nextval('person_id_seq'::regclass) |</span>
<span class="c1">-- | first_name | character varying(50)  |  not null                                            |</span>
<span class="c1">-- | last_name  | character varying(50)  |  not null                                            |</span>
<span class="c1">-- | gender     | character varying(7)   |  not null                                            |</span>
<span class="c1">-- | email      | character varying(100) |                                                      |</span>
<span class="c1">-- | dob        | date                   |  not null                                            |</span>
<span class="c1">-- | country    | character varying(50)  |  not null                                            |</span>
<span class="c1">-- | car_id     | bigint                 |                                                      |</span>
<span class="c1">-- +------------+------------------------+------------------------------------------------------+</span>
<span class="c1">-- Indexes:</span>
<span class="c1">--     "person_pkey" PRIMARY KEY, btree (id)</span>
<span class="c1">--     "person_car_id_key" UNIQUE CONSTRAINT, btree (car_id)</span>
<span class="c1">-- Foreign-key constraints:</span>
<span class="c1">--     "person_car_id_fkey" FOREIGN KEY (car_id) REFERENCES car(id)</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person_id_seq</span><span class="p">;</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- | last_value | log_cnt | is_called |</span>
<span class="c1">-- |------------+---------+-----------|</span>
<span class="c1">-- | 4          | 31      | True      |</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.013s</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+----------------+------------+-----------+--------+</span>
<span class="c1">-- | id | first_name | last_name | gender | email          | dob        | country   | car_id |</span>
<span class="c1">-- |----+------------+-----------+--------+----------------+------------+-----------+--------|</span>
<span class="c1">-- | 3  | John       | Matuschek | Male   | jon@fdbrnr.com | 1965-02-28 | England   | &lt;null&gt; |</span>
<span class="c1">-- | 1  | Fernanda   | Beardon   | Female | nandab@is.gd   | 1953-10-28 | Comoros   | 2      |</span>
<span class="c1">-- | 2  | Omar       | Colmore   | Male   | &lt;null&gt;         | 1921-04-03 | Finland   | 1      |</span>
<span class="c1">-- | 4  | Stern      | Oldacres  | Male   | &lt;null&gt;         | 2023-09-22 | Indonesia | 3      |</span>
<span class="c1">-- +----+------------+-----------+--------+----------------+------------+-----------+--------+</span>
<span class="c1">-- SELECT 4</span>
<span class="c1">-- Time: 0.010s</span>

<span class="c1">-- Last ID is 4</span>

<span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 5       |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.022s</span>

<span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 6       |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.022s</span>
<span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 7       |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.009s</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person_id_seq</span><span class="p">;</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- | last_value | log_cnt | is_called |</span>
<span class="c1">-- |------------+---------+-----------|</span>
<span class="c1">-- | 7          | 31      | True      |</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.004s</span>

<span class="c1">-- Now last ID is 7. So the next person added here will have the ID of 8</span>
<span class="k">INSERT</span> <span class="k">INTO</span>
    <span class="n">person</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">dob</span><span class="p">,</span> <span class="n">country</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Fiann'</span><span class="p">,</span> <span class="s1">'Pesik'</span><span class="p">,</span> <span class="s1">'fpesikq@senate.gov'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'2023/03/07'</span><span class="p">,</span> <span class="s1">'Indonesia'</span><span class="p">);</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- Time: 0.016s</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +----+------------+-----------+--------+--------------------+------------+-----------+--------+</span>
<span class="c1">-- | id | first_name | last_name | gender | email              | dob        | country   | car_id |</span>
<span class="c1">-- |----+------------+-----------+--------+--------------------+------------+-----------+--------|</span>
<span class="c1">-- | 3  | John       | Matuschek | Male   | jon@fdbrnr.com     | 1965-02-28 | England   | &lt;null&gt; |</span>
<span class="c1">-- | 1  | Fernanda   | Beardon   | Female | nandab@is.gd       | 1953-10-28 | Comoros   | 2      |</span>
<span class="c1">-- | 2  | Omar       | Colmore   | Male   | &lt;null&gt;             | 1921-04-03 | Finland   | 1      |</span>
<span class="c1">-- | 4  | Stern      | Oldacres  | Male   | &lt;null&gt;             | 2023-09-22 | Indonesia | 3      |</span>
<span class="c1">-- | 8  | Fiann      | Pesik     | Female | fpesikq@senate.gov | 2023-03-07 | Indonesia | &lt;null&gt; |</span>
<span class="c1">-- +----+------------+-----------+--------+--------------------+------------+-----------+--------+</span>
<span class="c1">-- SELECT 5</span>
<span class="c1">-- Time: 0.013s</span>
</code></pre></div></div>

<p>You can restart the sequence as well with the following…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 9       |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.021s</span>
<span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 10      |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.010s</span>

<span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'person_id_seq'</span><span class="p">::</span><span class="n">regclass</span><span class="p">);</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- | nextval |</span>
<span class="c1">-- |---------|</span>
<span class="c1">-- | 11      |</span>
<span class="c1">-- +---------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.009s</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person_id_seq</span><span class="p">;</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- | last_value | log_cnt | is_called |</span>
<span class="c1">-- |------------+---------+-----------|</span>
<span class="c1">-- | 11         | 29      | True      |</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.008s</span>

<span class="k">ALTER</span> <span class="n">SEQUENCE</span> <span class="n">person_id_seq</span> <span class="k">RESTART</span> <span class="k">WITH</span> <span class="mi">8</span><span class="p">;</span>
<span class="c1">-- ALTER SEQUENCE</span>
<span class="c1">-- Time: 0.026s</span>
 <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person_id_seq</span><span class="p">;</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- | last_value | log_cnt | is_called |</span>
<span class="c1">-- |------------+---------+-----------|</span>
<span class="c1">-- | 8          | 0       | False     |</span>
<span class="c1">-- +------------+---------+-----------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.004s</span>
</code></pre></div></div>

<h2 id="extensions">
<a class="anchor" href="#extensions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extensions</h2>

<p>Check all the available postgres extensions with the following…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_available_extension_versions</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="understanding-uuid-data-types">
<a class="anchor" href="#understanding-uuid-data-types" aria-hidden="true"><span class="octicon octicon-link"></span></a>Understanding UUID data types</h3>

<p>We are going to install the <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier" target="\_blank"><code class="language-plaintext highlighter-rouge">Universally Unique Identitifiers</code></a> (UUID) extension.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="n">EXTENSION</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="nv">"uuid-ossp"</span><span class="p">;</span>
<span class="c1">-- CREATE EXTENSION</span>

<span class="c1">-- a list of all available functions</span>
<span class="err">\</span><span class="n">df</span><span class="p">;</span>
<span class="c1">-- +--------+--------------------+------------------+---------------------------+--------+</span>
<span class="c1">-- | Schema | Name               | Result data type | Argument data types       | Type   |</span>
<span class="c1">-- |--------+--------------------+------------------+---------------------------+--------|</span>
<span class="c1">-- | public | uuid_generate_v1   | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_generate_v1mc | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_generate_v3   | uuid             | namespace uuid, name text | normal |</span>
<span class="c1">-- | public | uuid_generate_v4   | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_generate_v5   | uuid             | namespace uuid, name text | normal |</span>
<span class="c1">-- | public | uuid_nil           | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_ns_dns        | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_ns_oid        | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_ns_url        | uuid             |                           | normal |</span>
<span class="c1">-- | public | uuid_ns_x500       | uuid             |                           | normal |</span>
<span class="c1">-- +--------+--------------------+------------------+---------------------------+--------+</span>
<span class="c1">-- SELECT 10</span>
<span class="c1">-- Time: 0.093s</span>

<span class="c1">-- generate a UUID v4 (random)</span>
<span class="k">SELECT</span> <span class="n">uuid_generate_v4</span><span class="p">();</span>
<span class="c1">-- +--------------------------------------+</span>
<span class="c1">-- | uuid_generate_v4                     |</span>
<span class="c1">-- |--------------------------------------|</span>
<span class="c1">-- | 25edf5be-74b0-4ad0-9630-3d9fd9fb7db3 | -- &lt;-- will be unique every time function is invoked</span>
<span class="c1">-- +--------------------------------------+</span>
<span class="c1">-- SELECT 1</span>
<span class="c1">-- Time: 0.098s</span>
</code></pre></div></div>

<h3 id="uuid-as-primary-keys">
<a class="anchor" href="#uuid-as-primary-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>UUID as primary keys</h3>

<p>We will modify our sql file slightly…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">car</span> <span class="p">(</span>
    <span class="n">car_uid</span> <span class="n">UUID</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">make</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">model</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">NUMERIC</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">person</span> <span class="p">(</span>
    <span class="n">person_uid</span> <span class="n">UUID</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
    <span class="n">dob</span> <span class="nb">DATE</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">country</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">car_uid</span> <span class="n">UUID</span> <span class="k">REFERENCES</span> <span class="n">car</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">),</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">email</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- ... see ./sql/person-car-uuid.sql</span>

<span class="c1">-- CREATE TABLE</span>
<span class="c1">-- CREATE TABLE</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- INSERT 0 1</span>
<span class="c1">-- Time: 0.062s</span>

<span class="k">SELECT</span> <span class="n">person_uid</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +--------------------------------------+------------+-----------+</span>
<span class="c1">-- | person_uid                           | first_name | last_name |</span>
<span class="c1">-- |--------------------------------------+------------+-----------|</span>
<span class="c1">-- | b90135d4-48fd-4d04-8936-17c7a9503115 | Fernanda   | Beardon   |</span>
<span class="c1">-- | 83eda910-462e-4590-a63e-b4953ae1358d | Omar       | Colmore   |</span>
<span class="c1">-- | 64db451a-f54e-4b46-8565-12baf3854026 | John       | Matuschek |</span>
<span class="c1">-- +--------------------------------------+------------+-----------+</span>
<span class="c1">-- SELECT 3</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">car</span><span class="p">;</span>
<span class="c1">-- +--------------------------------------+------------+----------+----------+</span>
<span class="c1">-- | car_uid                              | make       | model    | price    |</span>
<span class="c1">-- |--------------------------------------+------------+----------+----------|</span>
<span class="c1">-- | 057d20f1-fc69-4d22-8362-0524dace063e | Land Rover | Sterling | 87665.38 |</span>
<span class="c1">-- | b8daa521-ddb0-4461-950a-7c76efd46247 | GMC        | Acadia   | 17662.69 |</span>
<span class="c1">-- +--------------------------------------+------------+----------+----------+</span>
<span class="c1">-- SELECT 2</span>
<span class="c1">-- Time: 0.017s</span>

<span class="c1">-- lets assign some cars</span>
<span class="k">UPDATE</span> <span class="n">person</span>
<span class="k">SET</span> <span class="n">car_uid</span> <span class="o">=</span> <span class="s1">'057d20f1-fc69-4d22-8362-0524dace063e'</span>
<span class="k">WHERE</span> <span class="n">person_uid</span> <span class="o">=</span> <span class="s1">'b90135d4-48fd-4d04-8936-17c7a9503115'</span><span class="p">;</span>
<span class="c1">-- UPDATE 1</span>

<span class="k">UPDATE</span> <span class="n">person</span>
<span class="k">SET</span> <span class="n">car_uid</span> <span class="o">=</span> <span class="s1">'b8daa521-ddb0-4461-950a-7c76efd46247'</span>
<span class="k">WHERE</span> <span class="n">person_uid</span> <span class="o">=</span> <span class="s1">'64db451a-f54e-4b46-8565-12baf3854026'</span><span class="p">;</span>
<span class="c1">-- UPDATE 1</span>

<span class="k">SELECT</span> <span class="n">person_uid</span><span class="p">,</span> <span class="n">car_uid</span> <span class="k">FROM</span> <span class="n">person</span><span class="p">;</span>
<span class="c1">-- +--------------------------------------+--------------------------------------+</span>
<span class="c1">-- | person_uid                           | car_uid                              |</span>
<span class="c1">-- |--------------------------------------+--------------------------------------|</span>
<span class="c1">-- | 83eda910-462e-4590-a63e-b4953ae1358d | &lt;null&gt;                               |</span>
<span class="c1">-- | b90135d4-48fd-4d04-8936-17c7a9503115 | 057d20f1-fc69-4d22-8362-0524dace063e |</span>
<span class="c1">-- | 64db451a-f54e-4b46-8565-12baf3854026 | b8daa521-ddb0-4461-950a-7c76efd46247 |</span>
<span class="c1">-- +--------------------------------------+--------------------------------------+</span>
</code></pre></div></div>

<p>To query this now like so…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">person</span>
<span class="k">JOIN</span> <span class="n">car</span> <span class="k">ON</span> <span class="n">person</span><span class="p">.</span><span class="n">car_uid</span> <span class="o">=</span> <span class="n">car</span><span class="p">.</span><span class="n">car_uid</span><span class="p">;</span>

<span class="c1">-- since both tables have a column named car_uid, the query can be simplified to:</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">USING</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">);</span>

<span class="c1">-- example with LEFT JOIN as well</span>

<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">person</span> <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">car</span> <span class="k">USING</span> <span class="p">(</span><span class="n">car_uid</span><span class="p">);</span>
</code></pre></div></div>
</section>

      <div class="col-span-2 hidden h-full md:mt-0 md:inline">
        <aside class="sticky top-20 pl-0 pt-0">
          <nav class="toc sticky left-12 top-0 w-auto p-4 leading-loose">
            <header class="font-bold">Table of Contents</header>
            <div class="text-sm"><ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#prerequisites">Prerequisites</a></li>
<li class="toc-entry toc-h2"><a href="#setup">Setup</a></li>
<li class="toc-entry toc-h2"><a href="#run">Run</a>
<ul>
<li class="toc-entry toc-h3"><a href="#note-regarding-pgcli-command">Note regarding PGCLI command</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#creating-a-database">Creating a database</a></li>
<li class="toc-entry toc-h2"><a href="#connect-to-database">Connect to database</a></li>
<li class="toc-entry toc-h2"><a href="#dropping-a-database">Dropping a database</a></li>
<li class="toc-entry toc-h2"><a href="#create-table">Create table</a>
<ul>
<li class="toc-entry toc-h3"><a href="#without-constraints">without constraints</a></li>
<li class="toc-entry toc-h3"><a href="#with-constraints">with constraints</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#drop-table">Drop table</a></li>
<li class="toc-entry toc-h2"><a href="#insert-into">Insert into</a>
<ul>
<li class="toc-entry toc-h3"><a href="#generate-mock-data-from-file">Generate mock data from file</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#selecting-from-table">Selecting from table</a>
<ul>
<li class="toc-entry toc-h3"><a href="#using-cluases">Using cluases</a></li>
<li class="toc-entry toc-h3"><a href="#comparison-operators">Comparison operators</a></li>
<li class="toc-entry toc-h3"><a href="#limit-offset-and-fetch">Limit, offset and fetch</a></li>
<li class="toc-entry toc-h3"><a href="#in">In</a></li>
<li class="toc-entry toc-h3"><a href="#between">Between</a></li>
<li class="toc-entry toc-h3"><a href="#like-and-ilike">Like and iLike</a>
<ul>
<li class="toc-entry toc-h4"><a href="#wildcard-">wildcard ‘%’</a></li>
<li class="toc-entry toc-h4"><a href="#wildcard-_">wildcard ‘_’</a></li>
<li class="toc-entry toc-h4"><a href="#ilike-case-insensitive">iLike (case insensitive)</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#group-by">Group by</a>
<ul>
<li class="toc-entry toc-h4"><a href="#having">Having</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#adding-new-table">Adding new table</a></li>
<li class="toc-entry toc-h2"><a href="#calculations">Calculations</a>
<ul>
<li class="toc-entry toc-h3"><a href="#max">Max</a></li>
<li class="toc-entry toc-h3"><a href="#min">Min</a></li>
<li class="toc-entry toc-h3"><a href="#avg">Avg</a></li>
<li class="toc-entry toc-h3"><a href="#sum">Sum</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#arithmetic-operators">Arithmetic operators</a>
<ul>
<li class="toc-entry toc-h3"><a href="#round">Round</a></li>
<li class="toc-entry toc-h3"><a href="#coalesce">Coalesce</a></li>
<li class="toc-entry toc-h3"><a href="#nullif">NULLIF</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#timastamps-and-dates">Timastamps and dates</a>
<ul>
<li class="toc-entry toc-h3"><a href="#adding-and-subtracting-with-dates-interval">Adding and subtracting with dates (INTERVAL)</a></li>
<li class="toc-entry toc-h3"><a href="#extracting-fields">Extracting fields</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#age-function">Age function</a></li>
<li class="toc-entry toc-h2"><a href="#primary-key">Primary key</a>
<ul>
<li class="toc-entry toc-h3"><a href="#alter-table">Alter table</a></li>
<li class="toc-entry toc-h3"><a href="#adding-primary-key">Adding primary key</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#unique-constraints">Unique constraints</a></li>
<li class="toc-entry toc-h2"><a href="#primary-key-vs-unique-constraint">Primary key vs Unique constraint</a></li>
<li class="toc-entry toc-h2"><a href="#check-constraint">Check constraint</a></li>
<li class="toc-entry toc-h2"><a href="#delete-records">Delete records</a></li>
<li class="toc-entry toc-h2"><a href="#update-records">Update records</a>
<ul>
<li class="toc-entry toc-h3"><a href="#note-about-updating">Note about updating</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#on-conflict-do-nothing">On conflict, do nothing</a></li>
<li class="toc-entry toc-h2"><a href="#upsert">Upsert</a></li>
<li class="toc-entry toc-h2"><a href="#foreign-keys-joins-and-relationships">Foreign keys, joins and relationships</a>
<ul>
<li class="toc-entry toc-h3"><a href="#adding-relationships-between-tables">Adding relationships between tables</a></li>
<li class="toc-entry toc-h3"><a href="#updating-foreign-keys-columns">Updating foreign keys columns</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#inner-joins">Inner joins</a></li>
<li class="toc-entry toc-h2"><a href="#left-joins">Left joins</a></li>
<li class="toc-entry toc-h2"><a href="#deleting-records-with-foreingn-keys">Deleting records with foreingn keys</a></li>
<li class="toc-entry toc-h2"><a href="#exporting-query-results-to-csv">Exporting query results to CSV</a></li>
<li class="toc-entry toc-h2"><a href="#serial-and-sequences">Serial and sequences</a></li>
<li class="toc-entry toc-h2"><a href="#extensions">Extensions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#understanding-uuid-data-types">Understanding UUID data types</a></li>
<li class="toc-entry toc-h3"><a href="#uuid-as-primary-keys">UUID as primary keys</a></li>
</ul>
</li>
</ul></div>
            <svg class="toc-marker" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <path stroke="#00F603" stroke-width="3" fill="transparent" stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" stroke-linejoin="round" transform="translate(-0.5, -0.5)" />
</svg>

          </nav>
        </aside>
      </div>
      <div class="grid justify-items-end gap-2"></div>
    </div>
  </div>
</article>

        </div>
      </div>
    </div>
  </body>
</html>
